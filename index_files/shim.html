<!DOCTYPE html>
<!-- saved from url=(0132)blob:https://3vsnmgvmr1tu7sf4mcqzl6oy1h3bj6g1q6htkbkd0lzblh3as5-h772489900.scf.usercontent.goog/5f475f69-09d0-44a5-bd21-c8be4db0f447 -->
<html lang="nl"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><script>(function(firebaseConfig, initialAuthToken, appId) {
        window.__firebase_config = firebaseConfig;
        window.__initial_auth_token = initialAuthToken;
        window.__app_id = appId;
            })("\n{\n  \"apiKey\": \"AIzaSyCqyCcs2R2e7AegGjvFAwG98wlamtbHvZY\",\n  \"authDomain\": \"bard-frontend.firebaseapp.com\",\n  \"projectId\": \"bard-frontend\",\n  \"storageBucket\": \"bard-frontend.firebasestorage.app\",\n  \"messagingSenderId\": \"175205271074\",\n  \"appId\": \"1:175205271074:web:2b7bd4d34d33bf38e6ec7b\"\n}\n","eyJhbGciOiJSUzI1NiIsImtpZCI6IjhkZDUxMTBhMGIwYjdkNDJhNDM2ODg4MzdmODg5M2M2OTNhM2RhNDMiLCJ0eXAiOiJKV1QifQ.eyJzdWIiOiJmaXJlYmFzZS1hZG1pbnNkay1mYnN2Y0BiYXJkLWZyb250ZW5kLmlhbS5nc2VydmljZWFjY291bnQuY29tIiwiYXVkIjoiaHR0cHM6XC9cL2lkZW50aXR5dG9vbGtpdC5nb29nbGVhcGlzLmNvbVwvZ29vZ2xlLmlkZW50aXR5LmlkZW50aXR5dG9vbGtpdC52MS5JZGVudGl0eVRvb2xraXQiLCJ1aWQiOiIwNTczMDgwODQ4ODE3MTk4NjE2NyIsImFwcElkIjoiY18yYTY3MjQ0YTczYmUyZDA2X2dpdGh1Yi1pbmRleC1odG1sLTYwMyIsImlzcyI6ImZpcmViYXNlLWFkbWluc2RrLWZic3ZjQGJhcmQtZnJvbnRlbmQuaWFtLmdzZXJ2aWNlYWNjb3VudC5jb20iLCJleHAiOjE3NTA4NzM0OTksImlhdCI6MTc1MDg2OTg5OSwiYWxnIjoiUlMyNTYifQ.Bfi8inmYzhGPGLCJMbA63ZKt-UHtW3Tj3aGN7Uk_sFa5wqpwXS_ys_IEDgQ50TUCUXDXgHK6XCrYaETHjPiJ0Xc6pPrW_gGf909x83dFP08aY6RRN8K0Gp3hYp5O3SVTE4T_c72ggX69gezJPe5NlEczVS8K7cRN5UzZPj7hTGTvdM1sTAm1pGEKdYw4YDG8SyJUXCg4lPWgck0gEclGlQcfbExVcvKhPSotqr88XXB3Kso9r1obepgV96CWSDe1vyPAy-aVg2gqYcfO9Qn8c3Ryj0QOIf5X4-2SJWRnnUZfd1XLX8YUHvZFe2nZly5yCZFpxw-VYZJi4lKA4VB2dw","c_2a67244a73be2d06_github-index-html-603")</script><script>(function() {
  // Ensure this script is executed only once
  if (window.firebaseAuthBridgeScriptLoaded) {
    return;
  }
  window.firebaseAuthBridgeScriptLoaded = true;

  let nextTokenPromiseId = 0;

  // Stores { resolve, reject } for ongoing token requests
  const pendingTokenPromises = {};

  // Listen for messages from the Host Application
  window.addEventListener('message', function(event) {

    const messageData = event.data;

  if (messageData && messageData.type === 'RESOLVE_NEW_FIREBASE_TOKEN') {
      const { success, token, error, promiseId } = messageData ?? {};
      if (pendingTokenPromises[promiseId]) {
        if (success) {
          pendingTokenPromises[promiseId].resolve(token);
        } else {
          pendingTokenPromises[promiseId].reject(new Error(error || 'Token refresh failed from host.'));
        }
        delete pendingTokenPromises[promiseId];
      }
    }
  });

  // Expose a function for the Generated App to request a new Firebase token
  window.requestNewFirebaseToken = function() {
    const currentPromiseId = nextTokenPromiseId++;
    const promise = new Promise((resolve, reject) => {
      pendingTokenPromises[currentPromiseId] = { resolve, reject };
    });
    if (window.parent && window.parent !== window) {
      window.parent.postMessage({
        type: 'REQUEST_NEW_FIREBASE_TOKEN',
        promiseId: currentPromiseId
      }, '*');
    } else {
      pendingTokenPromises[currentPromiseId].reject(new Error('No parent window to request token from.'));
      delete pendingTokenPromises[currentPromiseId];
    }
    return promise;
  };
})();</script><script>let realOriginalGetUserMedia = null;
if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
  realOriginalGetUserMedia = navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);
}

(function() {
  if (navigator.mediaDevices && navigator.mediaDevices.__proto__) {
    try {
      Object.defineProperty(navigator.mediaDevices.__proto__, 'getUserMedia', {
        get: function() {
          return undefined; // Or throw an error
        },
        configurable: false
      });
    } catch (error) {
      console.error("Error defining prototype getter:", error);
    }
  }
})();

(function() {
  let originalGetUserMedia = realOriginalGetUserMedia;

  const pendingMediaResolvers = {};
  let nextMediaPromiseId = 0;

  function interceptGetUserMedia() {
    if (navigator.mediaDevices) {
      Object.defineProperty(navigator.mediaDevices, 'getUserMedia', {
        value: function(constraints) {
          const mediaPromiseId = nextMediaPromiseId++;
          const promise = new Promise((resolve, reject) => {
            pendingMediaResolvers[mediaPromiseId] = (granted) => {
              delete pendingMediaResolvers[mediaPromiseId];
              if (granted) {
                if (originalGetUserMedia) {
                  originalGetUserMedia(constraints).then(resolve).catch(reject);
                } else {
                  reject(new Error("Original getUserMedia not available."));
                }
              } else {
              reject(new DOMException('Permission denied', 'NotAllowedError'));
            }
          };
        });

        window.parent.postMessage({
          type: 'requestMediaPermission',
          constraints: constraints,
          promiseId: mediaPromiseId,
        }, '*');

        return promise;
      },
      writable: false,
      configurable: false
    });
    }
  }

  interceptGetUserMedia();

  const observer = new MutationObserver(function(mutationsList, observer) {
    for (const mutation of mutationsList) {
      if (mutation.type === 'reconfigured' && mutation.name === 'getUserMedia' && mutation.object === navigator.mediaDevices) {
        interceptGetUserMedia();
      } else if (mutation.type === 'attributes' && mutation.attributeName === 'getUserMedia' && mutation.target === navigator.mediaDevices) {
        interceptGetUserMedia();
      } else if (mutation.type === 'childList' && mutation.addedNodes) {
        mutation.addedNodes.forEach(node => {
          if (node === navigator.mediaDevices) {
            interceptGetUserMedia();
          }
        });
      }
    }
  });

  window.addEventListener('message', function(event) {
    if (event.data) {
      if (event.data.type === 'resolveMediaPermission') {
        const { promiseId, granted } = event.data;
        if (pendingMediaResolvers[promiseId]) {
          pendingMediaResolvers[promiseId](granted);
        }
      }
    }
  });

})();</script><script>((function(modelInformation) {
  const originalFetch = window.fetch;
  // TODO: b/421908508 - Move these out of the script and match all generative AI model calls.
  let googleLlmBaseApiUrls = [
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.textModelName + ':streamGenerateContent',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.textModelName + ':generateContent',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.imageModelName + ':predict',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.imageModelName + ':predictLongRunning',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.videoModelName + ':predict',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.videoModelName + ':predictLongRunning',
  ];
  modelInformation.deprecatedTextModelNames.forEach((modelName) => {
    googleLlmBaseApiUrls.push(
      'https://generativelanguage.googleapis.com/v1beta/models/' + modelName + ':streamGenerateContent',
      'https://generativelanguage.googleapis.com/v1beta/models/' + modelName + ':generateContent',
    );
  });

  const pendingFetchResolvers = {};
  let nextPromiseId = 0;

  function handleStringInput(input, optionsArgument) {
    const actualUrl = input;
    const fetchCallArgs = [actualUrl, optionsArgument];
    const effectiveOptions = optionsArgument || {};
    const bodyForApiKeyCheck = effectiveOptions.body;
    const bodyForPostMessage = effectiveOptions.body;
    return { actualUrl, fetchCallArgs, effectiveOptions, bodyForApiKeyCheck, bodyForPostMessage };
  }

  function handleRequestInput(input, optionsArgument) {
    const actualUrl = input.url;
    const fetchCallArgs = [input, optionsArgument];
    const effectiveOptions = { method: input.method, headers: new Headers(input.headers) };
    let bodyForApiKeyCheck;
    let bodyForPostMessage;

    if (optionsArgument) {
      if (optionsArgument.method) effectiveOptions.method = optionsArgument.method;
      if (optionsArgument.headers) effectiveOptions.headers = new Headers(optionsArgument.headers);
      if ('body' in optionsArgument) {
        bodyForApiKeyCheck = optionsArgument.body;
        bodyForPostMessage = optionsArgument.body;
      } else {
        bodyForApiKeyCheck = undefined;
        bodyForPostMessage = input.body;
      }
    } else {
      bodyForApiKeyCheck = undefined;
      bodyForPostMessage = input.body;
    }
    return { actualUrl, fetchCallArgs, effectiveOptions, bodyForApiKeyCheck, bodyForPostMessage };
  }

  window.fetch = function(input, optionsArgument) {
    let actualUrl;
    let fetchCallArgs;
    let effectiveOptions = {};
    let bodyForApiKeyCheck;
    let bodyForPostMessage;

    if (typeof input === 'string') {
      ({actualUrl, fetchCallArgs, effectiveOptions, bodyForApiKeyCheck, bodyForPostMessage} = handleStringInput(input, optionsArgument));
    } else if (input instanceof Request) {
      ({actualUrl, fetchCallArgs, effectiveOptions, bodyForApiKeyCheck, bodyForPostMessage} = handleRequestInput(input, optionsArgument));
    } else {
      return originalFetch.apply(window, [input, optionsArgument]);
    }

    effectiveOptions.method = effectiveOptions.method || 'GET';
    if (!effectiveOptions.headers) {
      effectiveOptions.headers = new Headers();
    }


    if (typeof actualUrl === 'string' && googleLlmBaseApiUrls.some((url) => actualUrl.startsWith(url))) {
      let apiKeyIsNull = true;

      const regex = new RegExp("models/([^:]+)");
      const modelNameMatch = actualUrl.match(regex);
      const modelName = modelNameMatch ? modelNameMatch[1] : 'unspecified';


      try {
        const urlObject = new URL(actualUrl);  // Use URL object for robust parsing
        const apiKeyParam = urlObject.searchParams.get('key');
        if (apiKeyParam) {
          apiKeyIsNull = false;
        }
      } catch (e) {
        // Continue checks even if URL parsing fails
      }

      if (apiKeyIsNull && effectiveOptions.headers) {
        const h = new Headers(effectiveOptions.headers);
        const apiKeyHeaderValue = h.get('X-API-Key') || h.get('x-api-key');
        if (apiKeyHeaderValue) {
          apiKeyIsNull = false;
          return originalFetch.apply(window, fetchCallArgs);
        }
      }

      if (apiKeyIsNull && effectiveOptions.method && ['POST', 'PUT', 'PATCH'].includes(effectiveOptions.method.toUpperCase()) && typeof bodyForApiKeyCheck === 'string') {
        try {
          const bodyData = JSON.parse(bodyForApiKeyCheck);
          if (bodyData && bodyData.apiKey) {
            apiKeyIsNull = false;
            return originalFetch.apply(window, fetchCallArgs);
          }
        } catch (e) {
          // Ignore JSON parsing errors
        }
      }

      if(apiKeyIsNull) {
        const promiseId = nextPromiseId++;
        const promise = new Promise((resolve) => {
          pendingFetchResolvers[promiseId] = (resolvedResponse) => {
            delete pendingFetchResolvers[promiseId];
            resolve(resolvedResponse);
          };
        });

        let serializedBodyForPostMessage;
        if (typeof bodyForPostMessage === 'string' || bodyForPostMessage == null) {
            serializedBodyForPostMessage = bodyForPostMessage;
        } else if (bodyForPostMessage instanceof ReadableStream) {
            serializedBodyForPostMessage = null;
        } else {
            try {
                serializedBodyForPostMessage = JSON.stringify(bodyForPostMessage);
            } catch (e) {
                serializedBodyForPostMessage = null;
            }
        }

        const messageOptions = {
            method: effectiveOptions.method,
            headers: Object.fromEntries(new Headers(effectiveOptions.headers).entries()),
            body: serializedBodyForPostMessage
        };

        window.parent.postMessage({
          type: 'requestFetch',
          url: actualUrl,
          modelName: modelName,
          options: messageOptions,
          promiseId: promiseId,
        }, '*');

        return promise;
      }
      return originalFetch.apply(window, fetchCallArgs);
    }
    return originalFetch.apply(window, fetchCallArgs);
  };

  window.addEventListener('message', function(event) {
    if (event.data && event.data.type === 'resolveFetch') {
      const { promiseId, response } = event.data;
      if (pendingFetchResolvers[promiseId]) {
        try {
          const reconstructedResponse = new Response(response.body, {
            status: response.status,
            statusText: response.statusText,
            headers: new Headers(response.headers),
          });
          pendingFetchResolvers[promiseId](reconstructedResponse);
        } catch (error) {
          pendingFetchResolvers[promiseId](new Response(null, { status: 500, statusText: "Interceptor Response Reconstruction Error" }));
        }
      }
    }
  });

}))({"textModelName":"gemini-2.5-flash-preview-04-17","imageModelName":"imagen-3.0-generate-002","videoModelName":"veo-2.0-generate-001","deprecatedTextModelNames":["gemini-2.0-flash"]})</script><script>(function() {
  const originalConsoleLog = console.log;
  const originalConsoleError = console.error;

    /**
   * Normalizes an error event or a promise rejection reason into a structured error object.
   * @param {*} errorEventOrReason The error object or reason.
   * @return {object} Structured error data { message, name, stack }.
   */
  function getErrorObject(errorEventOrReason) {
    if (errorEventOrReason instanceof Error) {
      return {
        message: errorEventOrReason.message,
        name: errorEventOrReason.name,
        stack: errorEventOrReason.stack,
      };
    }
    // Fallback for non-Error objects.
    try {
      return {
        message: JSON.stringify(errorEventOrReason),
        name: 'UnknownErrorType',
        stack: null,
      };
    } catch (e) {
      return {
        message: String(errorEventOrReason),
        name: 'UnknownErrorTypeNonStringifiable',
        stack: null,
      };
    }
  }

  /**
   * Converts an array of arguments (from log/error) into a single string.
   * Handles Error objects specially to include their message and stack.
   * @param {Array<*>} args - Arguments passed to console methods.
   * @return {string} A string representation of the arguments.
   */
  function stringifyArgs(args) {
    return args
      .map((arg) => {
        if (arg instanceof Error) {
          const {message, stack} = arg;
          return `Error: ${message}${stack ? ('\nStack: ' + stack) : ''}`;
        }
        if (typeof arg === 'object' && arg !== null) {
          try {
            return JSON.stringify(arg);
          } catch (error) {
            return '[Circular Object]';
          }
        } else {
          return String(arg);
        }
      })
      .join(' ');
  }

  console.log = function(...args) {
    const logString = stringifyArgs(args);
    window.parent.postMessage({ type: 'log', message: logString }, '*');
    originalConsoleLog.apply(console, args);
  };

  console.error = function(...args) {
    let errorData;
    if (args.length > 0 && args[0] instanceof Error) {
      const err = args[0];
      // If the first arg is an Error, capture its details.
      errorData = {
        type: 'error',
        source: 'CONSOLE_ERROR',
        ...getErrorObject(err),
        rawArgsString: stringifyArgs(args.slice(1)),
        timestamp: new Date().toISOString(),
      };
    } else {
      // If not an Error object, treat all args as a general error message.
      errorData = {
        type: 'error',
        source: 'CONSOLE_ERROR',
        message: stringifyArgs(args),
        name: 'ConsoleLoggedError',
        stack: null,
        timestamp: new Date().toISOString(),
      };
    }
    window.parent.postMessage(errorData, '*');
    originalConsoleError.apply(console, args);
  };

  // Listen for global unhandled synchronous errors.
  window.addEventListener('error', function(event) {
    const errorDetails = event.error ? getErrorObject(event.error) : {
      message: event.message,
      name: 'GlobalError',
      stack: null,
      filename: event.filename,
      lineno: event.lineno,
      colno: event.colno,
    };

    window.parent.postMessage({
      type: 'error',
      source: 'global',
      ...errorDetails,
      message: errorDetails.message || event.message,
      timestamp: new Date().toISOString(),
    }, '*');
  });

  // Listen for unhandled promise rejections (asynchronous errors).
  window.addEventListener('unhandledrejection', function(event) {
    const errorDetails = getErrorObject(event.reason);

    window.parent.postMessage({
      type: 'error',
      source: 'unhandledrejection',
      ...errorDetails,
      message: errorDetails.message || 'Unhandled Promise Rejection',
      timestamp: new Date().toISOString(),
    }, '*');
  });

})();</script>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactief Spel: Vraag &amp; Aanbod met AI</title>
    <script src="https://cdn.tailwindcss.com/"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .graph-option {
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        .graph-option:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .correct {
            border-color: #22c55e; /* green-500 */
            background-color: #f0fdf4; /* green-50 */
        }
        .incorrect {
            border-color: #ef4444; /* red-500 */
            background-color: #fef2f2; /* red-50 */
        }
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 24px;
            height: 24px;
            border-radius: 50%;
            border-left-color: #09f;
            animation: spin 1s ease infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
<style>*, ::before, ::after{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / 0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }::backdrop{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / 0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }/* ! tailwindcss v3.4.16 | MIT License | https://tailwindcss.com */*,::after,::before{box-sizing:border-box;border-width:0;border-style:solid;border-color:#e5e7eb}::after,::before{--tw-content:''}:host,html{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;tab-size:4;font-family:ui-sans-serif, system-ui, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";font-feature-settings:normal;font-variation-settings:normal;-webkit-tap-highlight-color:transparent}body{margin:0;line-height:inherit}hr{height:0;color:inherit;border-top-width:1px}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,pre,samp{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-feature-settings:normal;font-variation-settings:normal;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{text-indent:0;border-color:inherit;border-collapse:collapse}button,input,optgroup,select,textarea{font-family:inherit;font-feature-settings:inherit;font-variation-settings:inherit;font-size:100%;font-weight:inherit;line-height:inherit;letter-spacing:inherit;color:inherit;margin:0;padding:0}button,select{text-transform:none}button,input:where([type=button]),input:where([type=reset]),input:where([type=submit]){-webkit-appearance:button;background-color:transparent;background-image:none}:-moz-focusring{outline:auto}:-moz-ui-invalid{box-shadow:none}progress{vertical-align:baseline}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}fieldset{margin:0;padding:0}legend{padding:0}menu,ol,ul{list-style:none;margin:0;padding:0}dialog{padding:0}textarea{resize:vertical}input::placeholder,textarea::placeholder{opacity:1;color:#9ca3af}[role=button],button{cursor:pointer}:disabled{cursor:default}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}[hidden]:where(:not([hidden=until-found])){display:none}.mx-auto{margin-left:auto;margin-right:auto}.mb-4{margin-bottom:1rem}.mb-6{margin-bottom:1.5rem}.mb-8{margin-bottom:2rem}.ml-3{margin-left:0.75rem}.mr-2{margin-right:0.5rem}.mt-2{margin-top:0.5rem}.mt-4{margin-top:1rem}.mt-6{margin-top:1.5rem}.flex{display:flex}.grid{display:grid}.hidden{display:none}.min-h-screen{min-height:100vh}.w-full{width:100%}.max-w-2xl{max-width:42rem}.max-w-4xl{max-width:56rem}.grid-cols-1{grid-template-columns:repeat(1, minmax(0, 1fr))}.flex-col{flex-direction:column}.items-center{align-items:center}.justify-center{justify-content:center}.gap-4{gap:1rem}.rounded-2xl{border-radius:1rem}.rounded-lg{border-radius:0.5rem}.border{border-width:1px}.border-purple-200{--tw-border-opacity:1;border-color:rgb(233 213 255 / var(--tw-border-opacity, 1))}.bg-blue-600{--tw-bg-opacity:1;background-color:rgb(37 99 235 / var(--tw-bg-opacity, 1))}.bg-gray-200{--tw-bg-opacity:1;background-color:rgb(229 231 235 / var(--tw-bg-opacity, 1))}.bg-purple-50{--tw-bg-opacity:1;background-color:rgb(250 245 255 / var(--tw-bg-opacity, 1))}.bg-purple-600{--tw-bg-opacity:1;background-color:rgb(147 51 234 / var(--tw-bg-opacity, 1))}.bg-slate-100{--tw-bg-opacity:1;background-color:rgb(241 245 249 / var(--tw-bg-opacity, 1))}.bg-slate-50{--tw-bg-opacity:1;background-color:rgb(248 250 252 / var(--tw-bg-opacity, 1))}.bg-white{--tw-bg-opacity:1;background-color:rgb(255 255 255 / var(--tw-bg-opacity, 1))}.p-4{padding:1rem}.p-6{padding:1.5rem}.px-4{padding-left:1rem;padding-right:1rem}.px-6{padding-left:1.5rem;padding-right:1.5rem}.px-8{padding-left:2rem;padding-right:2rem}.py-2{padding-top:0.5rem;padding-bottom:0.5rem}.py-3{padding-top:0.75rem;padding-bottom:0.75rem}.text-center{text-align:center}.text-2xl{font-size:1.5rem;line-height:2rem}.text-3xl{font-size:1.875rem;line-height:2.25rem}.text-5xl{font-size:3rem;line-height:1}.text-lg{font-size:1.125rem;line-height:1.75rem}.text-sm{font-size:0.875rem;line-height:1.25rem}.text-xl{font-size:1.25rem;line-height:1.75rem}.font-bold{font-weight:700}.font-normal{font-weight:400}.font-semibold{font-weight:600}.text-blue-600{--tw-text-opacity:1;color:rgb(37 99 235 / var(--tw-text-opacity, 1))}.text-gray-800{--tw-text-opacity:1;color:rgb(31 41 55 / var(--tw-text-opacity, 1))}.text-purple-800{--tw-text-opacity:1;color:rgb(107 33 168 / var(--tw-text-opacity, 1))}.text-purple-900{--tw-text-opacity:1;color:rgb(88 28 135 / var(--tw-text-opacity, 1))}.text-red-500{--tw-text-opacity:1;color:rgb(239 68 68 / var(--tw-text-opacity, 1))}.text-slate-600{--tw-text-opacity:1;color:rgb(71 85 105 / var(--tw-text-opacity, 1))}.text-slate-700{--tw-text-opacity:1;color:rgb(51 65 85 / var(--tw-text-opacity, 1))}.text-slate-800{--tw-text-opacity:1;color:rgb(30 41 59 / var(--tw-text-opacity, 1))}.text-slate-900{--tw-text-opacity:1;color:rgb(15 23 42 / var(--tw-text-opacity, 1))}.text-white{--tw-text-opacity:1;color:rgb(255 255 255 / var(--tw-text-opacity, 1))}.shadow-lg{--tw-shadow:0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);--tw-shadow-colored:0 10px 15px -3px var(--tw-shadow-color), 0 4px 6px -4px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.transition-colors{transition-property:color, background-color, border-color, fill, stroke, -webkit-text-decoration-color;transition-property:color, background-color, border-color, text-decoration-color, fill, stroke;transition-property:color, background-color, border-color, text-decoration-color, fill, stroke, -webkit-text-decoration-color;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);transition-duration:150ms}.hover\:bg-blue-700:hover{--tw-bg-opacity:1;background-color:rgb(29 78 216 / var(--tw-bg-opacity, 1))}.hover\:bg-gray-300:hover{--tw-bg-opacity:1;background-color:rgb(209 213 219 / var(--tw-bg-opacity, 1))}.hover\:bg-purple-700:hover{--tw-bg-opacity:1;background-color:rgb(126 34 206 / var(--tw-bg-opacity, 1))}@media (min-width: 640px){.sm\:w-auto{width:auto}.sm\:grid-cols-2{grid-template-columns:repeat(2, minmax(0, 1fr))}.sm\:flex-row{flex-direction:row}.sm\:gap-6{gap:1.5rem}.sm\:p-8{padding:2rem}.sm\:text-2xl{font-size:1.5rem;line-height:2rem}.sm\:text-4xl{font-size:2.25rem;line-height:2.5rem}}</style></head>
<body class="bg-slate-50 text-slate-800 flex items-center justify-center min-h-screen p-4">

    <div id="game-container" class="w-full max-w-4xl mx-auto bg-white p-6 sm:p-8 rounded-2xl shadow-lg">
        
        <div id="start-screen" class="text-center">
            <h1 class="text-3xl sm:text-4xl font-bold text-slate-900 mb-4">Spel: Vraag &amp; Aanbod Verschuivingen</h1>
            <p class="text-slate-600 mb-6 max-w-2xl mx-auto">Test je kennis over de dynamiek van vraag en aanbod. Kies bij elk scenario de juiste grafische weergave.</p>
            <div class="flex flex-col sm:flex-row gap-4 justify-center">
                <button id="start-button" class="bg-blue-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-blue-700 transition-colors text-lg">
                    Start het Spel
                </button>
                 <button id="generate-scenario-button" class="flex items-center justify-center bg-purple-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-purple-700 transition-colors text-lg">
                    <span class="mr-2">✨</span> Verzin een Scenario
                    <div id="generate-spinner" class="spinner ml-3 hidden"></div>
                </button>
            </div>
            <p id="generate-error" class="text-red-500 mt-4 text-sm hidden"></p>
        </div>

        <div id="question-screen" class="hidden">
            <div class="mb-6">
                <p id="question-counter" class="text-sm font-semibold text-blue-600">Vraag 1 / 15</p>
                <h2 class="text-xl sm:text-2xl font-bold text-slate-900 mt-2">Markt: <span id="markt-text" class="font-normal"></span></h2>
                <p id="scenario-text" class="mt-2 text-slate-700 bg-slate-100 p-4 rounded-lg"></p>
            </div>

            <div id="options-grid" class="grid grid-cols-1 sm:grid-cols-2 gap-4 sm:gap-6">
                <!-- Graph options will be inserted here by JavaScript -->
            </div>
            
            <div id="feedback-section" class="mt-6 hidden">
                <h3 id="feedback-title" class="text-xl font-bold"></h3>
                <p id="explanation-text" class="mt-2 text-slate-700"></p>
                 <button id="analyze-button" class="mt-4 flex items-center bg-gray-200 text-gray-800 font-bold py-2 px-4 rounded-lg hover:bg-gray-300 transition-colors">
                    <span class="mr-2">✨</span> Geef een Diepere Analyse
                    <div id="analyze-spinner" class="spinner ml-3 hidden"></div>
                </button>
                <div id="analysis-container" class="mt-4 p-4 bg-purple-50 border border-purple-200 rounded-lg hidden">
                    <h4 class="font-bold text-purple-800">Diepere Analyse</h4>
                    <p id="analysis-text" class="text-purple-900 mt-2"></p>
                    <p id="analysis-error" class="text-red-500 mt-2 text-sm hidden"></p>
                </div>
                <button id="next-button" class="mt-4 w-full sm:w-auto bg-blue-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-blue-700 transition-colors">
                    Volgende Vraag
                </button>
            </div>
        </div>

        <div id="end-screen" class="hidden text-center">
             <h1 class="text-3xl sm:text-4xl font-bold text-slate-900 mb-4">Spel Voltooid!</h1>
             <p class="text-2xl text-slate-700 mb-4">Je score:</p>
             <p id="score-text" class="text-5xl font-bold text-blue-600 mb-8">18 / 20</p>
             <p id="score-feedback" class="text-slate-600 mb-8 max-w-2xl mx-auto"></p>
             <button id="restart-button" class="bg-blue-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-blue-700 transition-colors text-lg">
                Opnieuw Spelen
            </button>
        </div>
    </div>

    <script>
        // --- DATASET MET OPGAVEN ---
        let opgaven = [
            // This will be populated with initial data below
        ];

        const initialOpgaven = [
             // Vraagverschuivingen
            {
                situatie: 1,
                markt: "De markt voor elektrische fietsen.",
                scenario: "De overheid introduceert een subsidie voor de aankoop van een nieuwe elektrische fiets om duurzaam vervoer te stimuleren.",
                opties: [
                    { type: { shift: 'vraag', direction: 'rechts' }, id: 'A' },
                    { type: { shift: 'aanbod', direction: 'rechts' }, id: 'B' },
                    { type: { move: 'vraag', direction: 'omhoog' }, id: 'C' },
                    { type: { shift: 'vraag', direction: 'links' }, id: 'D' }
                ],
                correct: 'A',
                uitleg: "De subsidie maakt het voor consumenten goedkoper om een elektrische fiets te kopen, waardoor ze bij elke gegeven prijs meer fietsen willen en kunnen kopen. Dit is een externe factor (overheidsbeleid) die de vraag beïnvloedt, dus de gehele vraaglijn verschuift naar rechts."
            },
            {
                situatie: 2,
                markt: "De markt voor vliegtickets naar zonnige bestemmingen.",
                scenario: "Het inkomen van de consumenten is het afgelopen jaar fors gestegen.",
                opties: [
                    { type: { shift: 'aanbod', direction: 'links' }, id: 'A' },
                    { type: { shift: 'vraag', direction: 'rechts' }, id: 'B' },
                    { type: { shift: 'vraag', direction: 'links' }, id: 'C' },
                    { type: { move: 'vraag', direction: 'omlaag' }, id: 'D' }
                ],
                correct: 'B',
                uitleg: "Vliegreizen naar zonnige bestemmingen zijn een luxe goed. Wanneer het inkomen van consumenten stijgt, kunnen en willen ze bij elke prijs meer van dit soort reizen kopen. Dit leidt tot een verschuiving van de vraaglijn naar rechts."
            },
            {
                situatie: 3,
                markt: "De markt voor concertkaarten van een specifieke artiest.",
                scenario: "De artiest raakt 'uit de mode' na een serie negatieve publicaties in de media.",
                opties: [
                    { type: { shift: 'aanbod', direction: 'links' }, id: 'A' },
                    { type: { move: 'vraag', direction: 'omlaag' }, id: 'B' },
                    { type: { shift: 'vraag', direction: 'rechts' }, id: 'C' },
                    { type: { shift: 'vraag', direction: 'links' }, id: 'D' }
                ],
                correct: 'D',
                uitleg: "Door de gedaalde populariteit (verandering in voorkeur) willen minder mensen een kaartje voor het concert, ongeacht de prijs. De vraag naar kaartjes daalt bij elke prijs, wat resulteert in een verschuiving van de vraaglijn naar links."
            },
            {
                situatie: 4,
                markt: "De markt voor Coca-Cola.",
                scenario: "De prijs van Pepsi, een concurrerend merk, wordt aanzienlijk verlaagd.",
                opties: [
                    { type: { shift: 'vraag', direction: 'links' }, id: 'A' },
                    { type: { shift: 'vraag', direction: 'rechts' }, id: 'B' },
                    { type: { shift: 'aanbod', direction: 'links' }, id: 'C' },
                    { type: { move: 'vraag', direction: 'omlaag' }, id: 'D' }
                ],
                correct: 'A',
                uitleg: "Pepsi en Coca-Cola zijn substitutiegoederen. Als de prijs van Pepsi daalt, zullen consumenten overstappen van Coca-Cola naar het goedkopere alternatief. Hierdoor daalt de vraag naar Coca-Cola bij elke prijs, en verschuift de vraaglijn naar links."
            },
            {
                situatie: 5,
                markt: "De markt voor gameconsoles.",
                scenario: "De prijs van populaire computerspellen (games), die je nodig hebt om op de console te spelen, daalt spectaculair.",
                opties: [
                    { type: { shift: 'vraag', direction: 'links' }, id: 'A' },
                    { type: { shift: 'aanbod', direction: 'rechts' }, id: 'B' },
                    { type: { shift: 'vraag', direction: 'rechts' }, id: 'C' },
                    { type: { move: 'aanbod', direction: 'omhoog' }, id: 'D' }
                ],
                correct: 'C',
                uitleg: "Gameconsoles en games zijn complementaire goederen. Als games goedkoper worden, wordt het aantrekkelijker om een gameconsole aan te schaffen. De vraag naar consoles stijgt daardoor bij elke prijs, wat leidt tot een verschuiving van de vraaglijn naar rechts."
            },
            {
                situatie: 6,
                markt: "De markt voor streamingdiensten (zoals Netflix).",
                scenario: "Een grote concurrent (zoals Disney+) verhoogt zijn abonnementsprijs aanzienlijk.",
                opties: [
                    { type: { shift: 'vraag', direction: 'rechts' }, id: 'A' },
                    { type: { shift: 'vraag', direction: 'links' }, id: 'B' },
                    { type: { shift: 'aanbod', direction: 'rechts' }, id: 'C' },
                    { type: { move: 'vraag', direction: 'omhoog' }, id: 'D' }
                ],
                correct: 'A',
                uitleg: "Omdat de concurrent (een substituut) duurder wordt, zullen sommige consumenten overstappen. Hierdoor stijgt de vraag naar deze streamingdienst bij elke prijs, wat leidt tot een verschuiving van de vraaglijn naar rechts."
            },
            {
                situatie: 7,
                markt: "De markt voor avocados.",
                scenario: "Een extreme droogte in belangrijke productielanden zoals Mexico en Peru vernietigt een groot deel van de oogst.",
                opties: [
                    { type: { shift: 'aanbod', direction: 'rechts' }, id: 'A' },
                    { type: { shift: 'vraag', direction: 'links' }, id: 'B' },
                    { type: { shift: 'aanbod', direction: 'links' }, id: 'C' },
                    { type: { move: 'aanbod', direction: 'omhoog' }, id: 'D' }
                ],
                correct: 'C',
                uitleg: "De mislukte oogst is een aanbodschok. Er zijn bij elke prijs minder avocado's beschikbaar op de wereldmarkt. Dit leidt tot een afname van het aanbod, wat een verschuiving van de aanbodlijn naar links betekent."
            },
            {
                situatie: 8,
                markt: "De markt voor vintage kleding.",
                scenario: "Duurzaamheid wordt een enorme trend onder jongeren, terwijl tegelijkertijd steeds meer kringloopwinkels en online platformen (zoals Vinted) opkomen.",
                opties: [
                    { type: { shift: 'vraag', direction: 'rechts' }, id: 'A' },
                    { type: { shift: 'aanbod', direction: 'rechts' }, id: 'B' },
                    { type: { shift: 'beide', directionV: 'rechts', directionA: 'rechts' }, id: 'C' },
                    { type: { shift: 'beide', directionV: 'rechts', directionA: 'links' }, id: 'D' }
                ],
                correct: 'C',
                uitleg: "Twee dingen gebeuren hier: 1) De voorkeur voor duurzaamheid verhoogt de vraag (vraaglijn naar rechts). 2) Het grotere aantal verkopers verhoogt het aanbod (aanbodlijn naar rechts). Beide lijnen verschuiven dus naar rechts."
            },
            {
                situatie: 9,
                markt: "De markt voor zonnepanelen.",
                scenario: "De overheid introduceert een forse productiesubsidie voor fabrikanten van zonnepanelen om groene energie te stimuleren.",
                opties: [
                    { type: { shift: 'vraag', direction: 'rechts' }, id: 'A' },
                    { type: { shift: 'aanbod', direction: 'rechts' }, id: 'B' },
                    { type: { shift: 'aanbod', direction: 'links' }, id: 'C' },
                    { type: { move: 'aanbod', direction: 'omlaag' }, id: 'D' }
                ],
                correct: 'B',
                uitleg: "Een subsidie voor producenten verlaagt hun productiekosten. Hierdoor kunnen en willen ze bij elke prijs meer zonnepanelen aanbieden. Dit resulteert in een verschuiving van de aanbodlijn naar rechts."
            },
            {
                situatie: 10,
                markt: "De markt voor nieuwe benzineauto's.",
                scenario: "De benzineprijs bereikt een recordhoogte en blijft stijgen, terwijl de overheid tegelijkertijd een dure, verplichte nieuwe uitstootfilter voor alle nieuwe auto's eist.",
                opties: [
                    { type: { shift: 'vraag', direction: 'links' }, id: 'A' },
                    { type: { shift: 'aanbod', direction: 'links' }, id: 'B' },
                    { type: { shift: 'beide', directionV: 'rechts', directionA: 'links' }, id: 'C' },
                    { type: { shift: 'beide', directionV: 'links', directionA: 'links' }, id: 'D' }
                ],
                correct: 'D',
                uitleg: "Een dubbel effect: 1) Hoge benzineprijzen maken het bezit van een benzineauto (een complementair goed) minder aantrekkelijk, dus de vraag daalt (vraaglijn naar links). 2) De verplichte filter verhoogt de productiekosten, dus het aanbod daalt (aanbodlijn naar links)."
            },
            {
                situatie: 11,
                markt: "De markt voor handdesinfectiemiddelen.",
                scenario: "Het griepseizoen blijkt onverwacht mild te zijn met zeer weinig besmettingen landelijk.",
                opties: [
                    { type: { shift: 'vraag', direction: 'links' }, id: 'A' },
                    { type: { shift: 'aanbod', direction: 'links' }, id: 'B' },
                    { type: { shift: 'vraag', direction: 'rechts' }, id: 'C' },
                    { type: { move: 'vraag', direction: 'omlaag' }, id: 'D' }
                ],
                correct: 'A',
                uitleg: "De behoefte en de waargenomen noodzaak om handdesinfectiemiddel te kopen daalt sterk. Door deze verandering in voorkeur/noodzaak daalt de vraag bij elke prijs, en verschuift de vraaglijn naar links."
            },
            {
                situatie: 12,
                markt: "De markt voor veganistische vleesvervangers.",
                scenario: "Een groot wetenschappelijk onderzoek toont aan dat deze producten significant bijdragen aan een langer en gezonder leven. Tegelijkertijd wordt een nieuwe productietechniek ontdekt die de kosten halveert.",
                opties: [
                    { type: { shift: 'vraag', direction: 'rechts' }, id: 'A' },
                    { type: { shift: 'aanbod', direction: 'rechts' }, id: 'B' },
                    { type: { shift: 'beide', directionV: 'links', directionA: 'rechts' }, id: 'C' },
                    { type: { shift: 'beide', directionV: 'rechts', directionA: 'rechts' }, id: 'D' }
                ],
                correct: 'D',
                uitleg: "Een perfecte storm: 1) Het positieve nieuws verhoogt de voorkeur en dus de vraag (vraaglijn naar rechts). 2) De lagere productiekosten verhogen het aanbod (aanbodlijn naar rechts). Beide lijnen verschuiven naar rechts."
            },
            {
                situatie: 13,
                markt: "De markt voor geschoolde bouwvakkers (arbeidsmarkt).",
                scenario: "De overheid start een gigantisch nationaal project om de komende tien jaar 200.000 huizen te bouwen.",
                opties: [
                    { type: { shift: 'vraag', direction: 'rechts' }, id: 'A' },
                    { type: { shift: 'aanbod', direction: 'rechts' }, id: 'B' },
                    { type: { shift: 'vraag', direction: 'links' }, id: 'C' },
                    { type: { move: 'aanbod', direction: 'omhoog' }, id: 'D' }
                ],
                correct: 'A',
                uitleg: "Het bouwproject verhoogt de vraag naar een productiefactor: arbeid. Bouwbedrijven hebben bij elk loon (prijs van arbeid) meer bouwvakkers nodig. De vraaglijn naar arbeid verschuift dus naar rechts."
            },
            {
                situatie: 14,
                markt: "De markt voor papieren boeken.",
                scenario: "De prijzen van e-readers en e-books dalen aanzienlijk door massaproductie.",
                opties: [
                    { type: { shift: 'vraag', direction: 'links' }, id: 'A' },
                    { type: { shift: 'aanbod', direction: 'links' }, id: 'B' },
                    { type: { shift: 'vraag', direction: 'rechts' }, id: 'C' },
                    { type: { move: 'vraag', direction: 'omlaag' }, id: 'D' }
                ],
                correct: 'A',
                uitleg: "E-books zijn een substituut voor papieren boeken. Nu het alternatief goedkoper is geworden, zal de vraag naar papieren boeken bij elke prijs afnemen. De vraaglijn verschuift naar links."
            },
            {
                situatie: 15,
                markt: "De markt voor festivaltickets.",
                scenario: "De organisatie kondigt een wereldberoemde, extreem populaire artiest aan als hoofdact. Tegelijkertijd worden de veiligheidseisen strenger, waardoor er minder bezoekers op het terrein worden toegelaten.",
                opties: [
                    { type: { shift: 'vraag', direction: 'rechts' }, id: 'A' },
                    { type: { shift: 'beide', directionV: 'rechts', directionA: 'links' }, id: 'B' },
                    { type: { shift: 'aanbod', direction: 'links' }, id: 'C' },
                    { type: { shift: 'beide', directionV: 'rechts', directionA: 'rechts' }, id: 'D' }
                ],
                correct: 'B',
                uitleg: "Weer twee effecten: 1) De populaire artiest zorgt voor een enorme toename in de vraag (vraaglijn naar rechts). 2) De beperkte capaciteit betekent een afname van het aanbod van tickets (aanbodlijn naar links)."
            }
        ];
        opgaven = [...initialOpgaven];

        // --- GAME STATE ---
        let currentQuestionIndex = 0;
        let score = 0;
        let answered = false;

        // --- DOM ELEMENTS ---
        const startScreen = document.getElementById('start-screen');
        const questionScreen = document.getElementById('question-screen');
        const endScreen = document.getElementById('end-screen');
        
        const startButton = document.getElementById('start-button');
        const restartButton = document.getElementById('restart-button');
        const nextButton = document.getElementById('next-button');
        const generateScenarioButton = document.getElementById('generate-scenario-button');
        const generateSpinner = document.getElementById('generate-spinner');
        const generateError = document.getElementById('generate-error');
        const analyzeButton = document.getElementById('analyze-button');
        const analyzeSpinner = document.getElementById('analyze-spinner');
        const analysisContainer = document.getElementById('analysis-container');
        const analysisText = document.getElementById('analysis-text');
        const analysisError = document.getElementById('analysis-error');

        const questionCounter = document.getElementById('question-counter');
        const marktText = document.getElementById('markt-text');
        const scenarioText = document.getElementById('scenario-text');
        const optionsGrid = document.getElementById('options-grid');
        
        const feedbackSection = document.getElementById('feedback-section');
        const feedbackTitle = document.getElementById('feedback-title');
        const explanationText = document.getElementById('explanation-text');
        const scoreText = document.getElementById('score-text');
        const scoreFeedback = document.getElementById('score-feedback');


        // --- SVG GRAPH DRAWING FUNCTION ---
        function drawGraph(containerId, graphType) {
            const width = 200;
            const height = 150;
            const padding = 20;
            const arrowSize = 6;

            const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
            svg.setAttribute("viewBox", `0 0 ${width} ${height}`);
            svg.setAttribute("class", "mx-auto");

            const g = document.createElementNS("http://www.w3.org/2000/svg", "g");
            g.innerHTML = `
                <line x1="${padding}" y1="${height - padding}" x2="${width - padding}" y2="${height - padding}" stroke="#64748b" stroke-width="1.5"/>
                <line x1="${padding}" y1="${height - padding}" x2="${padding}" y2="${padding}" stroke="#64748b" stroke-width="1.5"/>
                <text x="${width - padding + 5}" y="${height - padding + 5}" font-size="12" fill="#64748b" font-weight="bold">Q</text>
                <text x="${padding - 15}" y="${padding + 5}" font-size="12" fill="#64748b" font-weight="bold">P</text>
            `;
            svg.appendChild(g);

            const drawLine = (p1, p2, color, dashed = false) => {
                const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
                line.setAttribute("x1", p1.x); line.setAttribute("y1", p1.y);
                line.setAttribute("x2", p2.x); line.setAttribute("y2", p2.y);
                line.setAttribute("stroke", color); line.setAttribute("stroke-width", "2");
                if (dashed) line.setAttribute("stroke-dasharray", "4 2");
                return line;
            }
            
            const drawArrow = (from, to, color) => {
                const g = document.createElementNS("http://www.w3.org/2000/svg", "g");
                const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
                line.setAttribute("x1", from.x); line.setAttribute("y1", from.y);
                line.setAttribute("x2", to.x); line.setAttribute("y2", to.y);
                line.setAttribute("stroke", color); line.setAttribute("stroke-width", "1.5");
                g.appendChild(line);
                const angle = Math.atan2(to.y - from.y, to.x - from.x);
                const head = document.createElementNS("http://www.w3.org/2000/svg", "path");
                head.setAttribute("d", `M ${to.x} ${to.y} L ${to.x - arrowSize * Math.cos(angle - Math.PI / 6)} ${to.y - arrowSize * Math.sin(angle - Math.PI / 6)} L ${to.x - arrowSize * Math.cos(angle + Math.PI / 6)} ${to.y - arrowSize * Math.sin(angle + Math.PI / 6)} Z`);
                head.setAttribute("fill", color);
                g.appendChild(head);
                return g;
            }

            const v_p1 = { x: padding + 25, y: padding + 10 };
            const v_p2 = { x: width - padding - 25, y: height - padding - 10 };
            const a_p1 = { x: padding + 25, y: height - padding - 10 };
            const a_p2 = { x: width - padding - 25, y: padding + 10 };

            svg.appendChild(drawLine(v_p1, v_p2, '#3b82f6'));
            const v_text = document.createElementNS("http://www.w3.org/2000/svg", "text");
            v_text.setAttribute("x", v_p2.x + 5); v_text.setAttribute("y", v_p2.y + 5);
            v_text.setAttribute("font-size", "12"); v_text.setAttribute("fill", "#3b82f6");
            v_text.textContent = "V"; svg.appendChild(v_text);

            svg.appendChild(drawLine(a_p1, a_p2, '#f97316'));
            const a_text = document.createElementNS("http://www.w3.org/2000/svg", "text");
            a_text.setAttribute("x", a_p2.x + 5); a_text.setAttribute("y", a_p2.y - 5);
            a_text.setAttribute("font-size", "12"); a_text.setAttribute("fill", "#f97316");
            a_text.textContent = "A"; svg.appendChild(a_text);

            const shiftAmount = 25;
            if (graphType.shift) {
                if (graphType.shift === 'vraag' || graphType.shift === 'beide') {
                    const dir = graphType.direction === 'rechts' || graphType.directionV === 'rechts' ? 1 : -1;
                    const v_new_p1 = { x: v_p1.x + dir * shiftAmount, y: v_p1.y };
                    const v_new_p2 = { x: v_p2.x + dir * shiftAmount, y: v_p2.y };
                    svg.appendChild(drawLine(v_new_p1, v_new_p2, '#3b82f6', true));
                    const arrowY = height * 0.75;
                    svg.appendChild(drawArrow({x: width/2 - dir*5, y: arrowY}, {x: width/2 + dir*10, y: arrowY}, '#3b82f6'));
                }
                 if (graphType.shift === 'aanbod' || graphType.shift === 'beide') {
                    const dir = graphType.direction === 'rechts' || graphType.directionA === 'rechts' ? 1 : -1;
                    const a_new_p1 = { x: a_p1.x + dir * shiftAmount, y: a_p1.y };
                    const a_new_p2 = { x: a_p2.x + dir * shiftAmount, y: a_p2.y };
                    svg.appendChild(drawLine(a_new_p1, a_new_p2, '#f97316', true));
                    const arrowY = height * 0.25;
                    svg.appendChild(drawArrow({x: width/2 - dir*5, y: arrowY}, {x: width/2 + dir*10, y: arrowY}, '#f97316'));
                }
            } else if (graphType.move) {
                 // CORRECTED: This block is now intentionally empty.
            } else if (graphType.price_control) {
                const pos = graphType.position === 'onder' ? 1 : -1;
                const y = height/2 + pos * 30;
                const line = drawLine({x: padding, y}, {x: width - padding, y}, '#16a34a', true);
                line.setAttribute('stroke-width', '2.5'); svg.appendChild(line);
                const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
                text.setAttribute("x", width-padding+5); text.setAttribute("y", y+4);
                text.setAttribute("font-size", "10"); text.setAttribute("fill", "#16a34a");
                text.textContent = graphType.price_control === 'max' ? "Pmax" : "Pmin";
                svg.appendChild(text);
            }

            document.getElementById(containerId).appendChild(svg);
        }

        // --- GAME LOGIC FUNCTIONS ---
        function showQuestion() {
            answered = false;
            feedbackSection.classList.add('hidden');
            analysisContainer.classList.add('hidden');
            analyzeButton.disabled = false;
            optionsGrid.innerHTML = '';
            
            const q = opgaven[currentQuestionIndex];
            questionCounter.textContent = `Vraag ${currentQuestionIndex + 1} / ${opgaven.length}`;
            marktText.textContent = q.markt;
            scenarioText.textContent = q.scenario;

            q.opties.forEach(option => {
                const optionEl = document.createElement('button');
                optionEl.className = 'graph-option border-2 border-slate-200 rounded-lg p-4 bg-white cursor-pointer text-left';
                optionEl.dataset.id = option.id;

                const label = document.createElement('div');
                label.className = 'font-bold text-lg mb-2';
                label.textContent = `Grafiek ${option.id}`;
                
                const graphContainer = document.createElement('div');
                graphContainer.id = `graph-${option.id}`;
                
                optionEl.appendChild(label);
                optionEl.appendChild(graphContainer);
                optionsGrid.appendChild(optionEl);

                drawGraph(graphContainer.id, option.type);

                optionEl.addEventListener('click', () => handleAnswer(option.id));
            });
        }

        function handleAnswer(selectedId) {
            if (answered) return;
            answered = true;

            const q = opgaven[currentQuestionIndex];
            const isCorrect = selectedId === q.correct;
            
            if (isCorrect) {
                score++;
                feedbackTitle.textContent = "Correct!";
                feedbackTitle.className = "text-xl font-bold text-green-600";
            } else {
                feedbackTitle.textContent = "Helaas, niet correct.";
                feedbackTitle.className = "text-xl font-bold text-red-600";
            }
            
            explanationText.innerHTML = `<span class="font-bold">Uitleg:</span> ${q.uitleg}`;
            feedbackSection.classList.remove('hidden');

            document.querySelectorAll('.graph-option').forEach(btn => {
                btn.disabled = true;
                const btnId = btn.dataset.id;
                if (btnId === q.correct) btn.classList.add('correct');
                else if (btnId === selectedId) btn.classList.add('incorrect');
            });
        }

        function showEndScreen() {
            questionScreen.classList.add('hidden');
            endScreen.classList.remove('hidden');
            scoreText.textContent = `${score} / ${opgaven.length}`;
            
            let feedback = "Goed gedaan!";
            const percentage = score / opgaven.length;
            if (percentage < 0.5) feedback = "Dat kan beter, probeer het nog een keer om de concepten te oefenen.";
            else if (percentage < 0.8) feedback = "Een mooie score! Je bent goed op weg.";
            else feedback = "Uitstekend werk! Je hebt de dynamiek van vraag en aanbod goed onder de knie."
            scoreFeedback.textContent = feedback;
        }

        // --- GEMINI API FUNCTIONS ---

        async function callGemini(prompt, isJson = false) {
             const apiKey = ""; 
             const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

            const payload = {
                contents: [{ role: "user", parts: [{ text: prompt }] }],
            };

            if (isJson) {
                payload.generationConfig = {
                    responseMimeType: "application/json",
                    responseSchema: {
                        type: "OBJECT",
                        properties: {
                            "markt": { "type": "STRING" },
                            "scenario": { "type": "STRING" },
                            "verschuiving": { "type": "STRING" },
                            "uitleg": { "type": "STRING" }
                        },
                        required: ["markt", "scenario", "verschuiving", "uitleg"]
                    }
                };
            }

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                if (!response.ok) {
                    throw new Error(`API verzoek mislukt met status: ${response.status}`);
                }
                const result = await response.json();
                if (result.candidates && result.candidates.length > 0 && result.candidates[0].content && result.candidates[0].content.parts.length > 0) {
                    return result.candidates[0].content.parts[0].text;
                } else {
                    throw new Error("Ongeldig antwoordformaat van API.");
                }
            } catch (error) {
                console.error("Fout bij het aanroepen van de Gemini API:", error);
                throw error;
            }
        }
        
        // --- EVENT LISTENERS ---
        startButton.addEventListener('click', () => {
            startScreen.classList.add('hidden');
            questionScreen.classList.remove('hidden');
            showQuestion();
        });

        generateScenarioButton.addEventListener('click', async () => {
            generateSpinner.classList.remove('hidden');
            generateError.classList.add('hidden');
            generateScenarioButton.disabled = true;

            const prompt = `Genereer een uniek en creatief economisch scenario voor een vraag- en aanbodspel voor middelbare scholieren (havo/vwo niveau). Het scenario moet een duidelijke verschuiving van ofwel de vraaglijn, ofwel de aanbodlijn veroorzaken. Geef een korte uitleg. Antwoord in het Nederlands. De verschuiving moet een van de volgende zijn: 'vraag naar rechts', 'vraag naar links', 'aanbod naar rechts', 'aanbod naar links'.`;
            
            try {
                const jsonResponse = await callGemini(prompt, true);
                const aiOpgave = JSON.parse(jsonResponse);

                const shiftMap = {
                    'vraag naar rechts': { shift: 'vraag', direction: 'rechts' },
                    'vraag naar links': { shift: 'vraag', direction: 'links' },
                    'aanbod naar rechts': { shift: 'aanbod', direction: 'rechts' },
                    'aanbod naar links': { shift: 'aanbod', direction: 'links' },
                };
                
                const correctType = shiftMap[aiOpgave.verschuiving.toLowerCase()];
                if (!correctType) throw new Error("Onbekende verschuiving van AI.");

                const distractors = Object.values(shiftMap).filter(v => v.shift !== correctType.shift || v.direction !== correctType.direction);
                // Also add a 'move' distractor
                distractors.push({ move: 'vraag', direction: 'omlaag' });
                distractors.sort(() => Math.random() - 0.5);


                const options = [ { type: correctType, id: 'A' } ];
                for(let i=0; i<3; i++) {
                    options.push({ type: distractors[i], id: String.fromCharCode(66 + i) });
                }
                options.sort(() => Math.random() - 0.5);
                const correctId = options.find(o => o.type.shift === correctType.shift && o.type.direction === correctType.direction).id;


                const newQuestion = {
                    situatie: opgaven.length + 1,
                    markt: aiOpgave.markt,
                    scenario: aiOpgave.scenario,
                    opties: options,
                    correct: correctId,
                    uitleg: aiOpgave.uitleg,
                    isAiGenerated: true
                };

                opgaven.push(newQuestion);
                currentQuestionIndex = opgaven.length - 1;
                score = 0;
                
                startScreen.classList.add('hidden');
                questionScreen.classList.remove('hidden');
                showQuestion();

            } catch (error) {
                generateError.textContent = "Er ging iets mis bij het genereren van het scenario. Probeer het opnieuw.";
                generateError.classList.remove('hidden');
            } finally {
                generateSpinner.classList.add('hidden');
                generateScenarioButton.disabled = false;
            }
        });

        analyzeButton.addEventListener('click', async () => {
            analyzeSpinner.classList.remove('hidden');
            analysisContainer.classList.add('hidden');
            analysisError.classList.add('hidden');
            analyzeButton.disabled = true;

            const q = opgaven[currentQuestionIndex];
            const prompt = `Analyseer het volgende economische scenario voor een middelbare scholier. Leg in 2-3 zinnen uit wat de mogelijke tweede-orde-effecten zijn, of geef een relevant, actueel voorbeeld uit de echte wereld. Het scenario is: '${q.scenario}' op de markt voor '${q.markt}'. De basisuitleg is: '${q.uitleg}'. Geef alleen de diepere analyse, in het Nederlands.`;

            try {
                const analysisResult = await callGemini(prompt, false);
                analysisText.textContent = analysisResult;
                analysisContainer.classList.remove('hidden');
            } catch (error) {
                analysisError.textContent = "Analyse kon niet worden opgehaald.";
                analysisContainer.classList.remove('hidden'); // Show container to display error
                analysisError.classList.remove('hidden');
            } finally {
                 analyzeSpinner.classList.add('hidden');
            }
        });

        nextButton.addEventListener('click', () => {
            currentQuestionIndex++;
            if (currentQuestionIndex < opgaven.length) {
                showQuestion();
            } else {
                showEndScreen();
            }
        });

        restartButton.addEventListener('click', () => {
            opgaven = [...initialOpgaven];
            currentQuestionIndex = 0;
            score = 0;
            endScreen.classList.add('hidden');
            startScreen.classList.remove('hidden');
        });
    </script>


</body></html>